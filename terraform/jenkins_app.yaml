#cloud-config
groups:
  - ubuntu: [root,sys]
  - hashicorp

# Add users to the system. Users are added after groups are added.
users:
  - default
  - name: terraform
    gecos: terraform
    shell: /bin/bash
    primary_group: hashicorp
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: users, admin
    lock_passwd: false
    ssh_authorized_keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDtJbuq5qzVTFNOCg47x8Frh6y5Nnw9RcX8GvR2NZjZYl2TEzw0/s4NdrRhAXndpKZ1RqvgmL6ui5aQehLOiL0Xhdy4roW4KhpP+Xpk/nipwEGDY/NwCrp073lRaf/Uj8R3je56kPAyIWIDW800H3JlCGFPwgRYlM0RWUsGtQgm6XWGmnUBwWEtBi9adaIial5g44O4ZoTG9ub2pHZkB9OxPAY8mFv3EBHrKmTrBaXAdnkdDgLTnuTizwrurPoaQuPIDNDXYcD9BOQ8GzDFtpl7kP0hDjghEvx4Mik9weGMbPI8+6WlJexRdukgtm40DolMVN/Ow5yEHpOK62gVgdV6wIy5eGKy0DnRH9Vp8KTf2Pziw3W4pdKQhhKWAx6elDJH1BK0R0RxzfVJnmdizA+2Lv79+TWubPNZZkR1uEJ4/6esKDtJUy7oTYqRutucIK9u/F/dVMqCRyOj1AyY71BoXkVRygO4w9i35ZoLLwLlngon2/j9tw+2qUvcyYcHmc8= walter@centre

runcmd:
  # Installing Jenkins
  - wget -q -O - https://pkg.jenkins.io/debian-stable/jenkins.io.key |sudo gpg --dearmor -o /usr/share/keyrings/jenkins.gpg
  - sudo sh -c 'echo deb [signed-by=/usr/share/keyrings/jenkins.gpg] http://pkg.jenkins.io/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list'
  - sudo apt update
  - sudo apt install default-jdk
  - sudo apt install -y -q jenkins
  - sudo systemctl start jenkins.service
  # Installing Docker
  - sudo apt remove docker docker-engine docker.io containerd runc
  - sudo apt install -y -q ca-certificates curl gnupg lsb-release
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
  - sudo chmod a+r /etc/apt/keyrings/docker.gpg
  - echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
  - sudo apt update
  - sudo apt install -y -q docker-ce docker-ce-cli containerd.io docker-compose-plugin
  # Installing kubectl
  - sudo apt update
  - sudo apt install -y -q ca-certificates curl
  - sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg
  - echo "deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main" | sudo tee /etc/apt/sources.list.d/kubernetes.list
  - sudo apt update
  - sudo apt install -y -q kubectl